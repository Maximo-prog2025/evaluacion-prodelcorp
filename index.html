<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Simulacro ‚Äî Acceso restringido</title>
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --accent:#0b63d6; --muted:#666; --ok:#0a8a3f; --bad:#d02a2a;
  }
  body{
    font-family: Inter, system-ui, "Segoe UI", Roboto, Arial, sans-serif;
    margin:0; background:var(--bg); color:#111;
  }
  .wrap{max-width:900px;margin:22px auto;padding:18px}
  header{display:flex;align-items:center;gap:16px;margin-bottom:8px}
  h1{margin:0;font-size:20px}
  .chip{background:#f0f6ff;color:var(--accent);padding:6px 10px;border-radius:999px;font-weight:600}
  .timer{margin-left:auto;font-weight:800;color:var(--accent)}
  .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(12,30,60,0.06)}
  .section-title{font-weight:700;margin-top:14px;margin-bottom:6px}
  .question{padding:12px;border-radius:10px;margin-bottom:10px;border:1px solid #eef2f8;background:#fff}
  .qtext{font-size:15px;margin-bottom:8px}
  .options{display:flex;flex-direction:column;gap:8px}
  .option{padding:8px;border-radius:8px;border:1px solid #e6e9ef;cursor:pointer;user-select:none}
  .option input{margin-right:8px}
  .controls{display:flex;gap:8px;align-items:center;margin-top:14px}
  button{background:var(--accent);color:#fff;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  button.ghost{background:transparent;color:var(--accent);border:1px solid #dbe9ff}
  .result{margin-top:18px;padding:12px;border-radius:10px;background:#fbfdff;border:1px solid #eef6ff}
  .login-area{text-align:center;margin-top:80px}
  .denied{text-align:center;color:var(--bad);font-weight:600;margin-top:80px}
  .user-actions{display:flex;gap:8px;align-items:center;margin-left:auto}
  .detail-item{padding:10px;border-radius:8px;border:1px solid #eef2f8;margin-bottom:8px;background:white}
  .ok{border-left:6px solid var(--ok);padding-left:10px}
  .bad{border-left:6px solid var(--bad);padding-left:10px}
  .meta{font-size:13px;color:var(--muted)}
  .small{font-size:13px;padding:6px 10px}
  pre{white-space:pre-wrap;font-family:inherit}
  @media (max-width:640px){.wrap{padding:12px}}
</style>

<!-- ====== GOOGLE LOGIN Y CONTROL DE ACCESO ====== -->
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script src="https://cdn.jsdelivr.net/npm/jwt-decode/build/jwt-decode.min.js"></script>

<script>
  // === CLIENTE GOOGLE ===
  const CLIENT_ID = "447366046291-0ted51mtkamjnrj7vv015vb7bvcs39eh.apps.googleusercontent.com";

  // === CORREOS AUTORIZADOS ===
  const AUTH_USERS = ["maxponcep@gmail.com", "consulbf12@gmail.com"];

  // === FUNCI√ìN PRINCIPAL: PROCESA RESPUESTA GOOGLE ===
  function handleCredentialResponse(response) {
    console.log("Respuesta de Google:", response);
    const data = jwt_decode(response.credential);
    const email = data.email;
    console.log("Usuario autenticado:", email);

    if (AUTH_USERS.includes(email)) {
      document.getElementById("login-container").style.display = "none";
      document.getElementById("main-content").style.display = "block";
      sessionStorage.setItem("user", email);
    } else {
      alert("‚ö†Ô∏è Acceso restringido. Tu cuenta no est√° autorizada.");
      google.accounts.id.disableAutoSelect();
      sessionStorage.clear();
      location.reload();
    }
  }

  // === CONFIGURACI√ìN DEL BOT√ìN GOOGLE ===
  window.onload = function () {
    google.accounts.id.initialize({
      client_id: CLIENT_ID,
      callback: handleCredentialResponse,
      ux_mode: "popup", // üî∏ evita redirecciones y el error 405
      auto_select: false
    });

    google.accounts.id.renderButton(
      document.getElementById("g_id_signin"),
      { theme: "outline", size: "large" }
    );

    // Verificar si ya hay sesi√≥n activa
    const user = sessionStorage.getItem("user");
    if (user && AUTH_USERS.includes(user)) {
      document.getElementById("login-container").style.display = "none";
      document.getElementById("main-content").style.display = "block";
    }
  };
</script>


/* ======= TU SIMULADOR (10 preguntas integradas) ======= */
function startExam(){
  const questions = [
  {
    id: 1,
    question: `Establezca la relaci√≥n correcta entre el n√∫mero y la letra respecto a la determinaci√≥n del m√©todo de contrataci√≥n que corresponda: 
1. Subasta Inversa Electr√≥nica 
2. Catalogo Electr√≥nico de Acuerdo Marco 
3. Licitaci√≥n P√∫blica 
a. Arroz pilado superior por el monto de S/ 50 000.00.
b. Construcci√≥n de centro educativo por el monto de S/ 7,500,000.00
c. Gas licuado de petr√≥leo por el monto de S/ 60 000.00.
d. Servicio de pasajes a√©reos nacionales por el monto de S/ 80 000.00`,
    options: [
      { text: "a) 1a, 1b, 2c, 3d", isCorrect: false },
      { text: "b) 1a, 1c, 2d, 3b", isCorrect: true },
      { text: "c) 1a, 1b, 1d, 2c", isCorrect: false },
      { text: "d) 3a, 3b, 3c, 3d", isCorrect: false }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  },
  {
    id: 2,
    question: `De la revisi√≥n del requerimiento, se advierte que, se exige una (1) camioneta 4 x 4 doble cabina, sin embargo, no se ha precisado las caracter√≠sticas de la camioneta. ¬øQu√© principio se ha vulnerado?`,
    options: [
      { text: "a) Principio de Publicidad", isCorrect: false },
      { text: "b) Principio de Libertad de Concurrencia", isCorrect: false },
      { text: "c) Principio de Transparencia", isCorrect: true },
      { text: "d) Principio de Igualdad de trato", isCorrect: false }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  },
  {
    id: 3,
    question: `De la revisi√≥n de los requisitos para la suscripci√≥n del contrato se advierte que, se requiere la presentaci√≥n de una declaraci√≥n jurada de cada personal propuesto se√±alando que no se encuentra trabajando en otra Entidad P√∫blica o Privada y que no lo realizar√° durante la prestaci√≥n de sus servicios en la ejecuci√≥n de la presente obra, adjuntado copia legible de su DNI. ¬øQu√© principio se ha vulnerado?`,
    options: [
      { text: "a) Principio de Competencia", isCorrect: false },
      { text: "b) Principio de Libertad de Concurrencia", isCorrect: true },
      { text: "c) Principio de Transparencia", isCorrect: false },
      { text: "d) Principio de Igualdad de trato", isCorrect: false }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  },
  {
    id: 4,
    question: `El principio de Equidad es aplicable durante:`,
    options: [
      { text: "a) La fase de actuaciones preparatorias", isCorrect: false },
      { text: "b) La fase de selecci√≥n", isCorrect: false },
      { text: "c) La fase de ejecuci√≥n contractual", isCorrect: true },
      { text: "d) La fase de pago", isCorrect: false }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  },
  {
    id: 5,
    question: `En qu√© casos, se incurre en fraccionamiento.`,
    options: [
      { text: "a) Surge una necesidad imprevisible adicional a la programada.", isCorrect: false },
      { text: "b) No se contaba con los recursos disponibles suficientes para realizar la contrataci√≥n", isCorrect: false },
      { text: "c) Se efect√∫e a trav√©s de los Cat√°logos Electr√≥nicos de Acuerdo Marco.", isCorrect: false },
      { text: "d) Divide una contrataci√≥n de servicios, para la cual cuenta con presupuesto disponible para su ejecuci√≥n integral, en varios contratos menores.", isCorrect: true }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  },
  {
    id: 6,
    question: `Seg√∫n la Ley General de Contrataciones P√∫blicas, ¬øcu√°l es el prop√≥sito fundamental del expediente de contrataci√≥n?`,
    options: [
      { text: "a) Servir como registro exclusivo de la fase de selecci√≥n.", isCorrect: false },
      { text: "b) Contener la informaci√≥n que respalda las actuaciones desde la formulaci√≥n del requerimiento hasta el cumplimiento total del contrato.", isCorrect: true },
      { text: "c) Documentar √∫nicamente los aspectos t√©cnicos del requerimiento.", isCorrect: false },
      { text: "d) Justificar la elecci√≥n de un procedimiento de selecci√≥n no competitivo.", isCorrect: false }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  },
  {
    id: 7,
    question: `¬øQu√© documento debe formar parte del expediente de contrataci√≥n antes de la fase de selecci√≥n?`,
    options: [
      { text: "a) El contrato perfeccionado.", isCorrect: false },
      { text: "b) La conformidad de la prestaci√≥n.", isCorrect: false },
      { text: "c) La estrategia de contrataci√≥n.", isCorrect: true },
      { text: "d) El laudo arbitral.", isCorrect: false }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  },
  {
    id: 8,
    question: `Adem√°s de la fase de actuaciones preparatorias, ¬øqu√© otras fases del proceso de contrataci√≥n deben estar documentadas en el expediente de contrataci√≥n seg√∫n la Ley?`,
    options: [
      { text: "a) Solo la fase de selecci√≥n.", isCorrect: false },
      { text: "b) Solo la fase de ejecuci√≥n contractual.", isCorrect: false },
      { text: "c) La fase de selecci√≥n y la fase de ejecuci√≥n contractual.", isCorrect: true },
      { text: "d) √önicamente la soluci√≥n de controversias.", isCorrect: false }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  },
  {
    id: 9,
    question: `¬øEs obligatorio incluir la cuant√≠a de la contrataci√≥n y la certificaci√≥n presupuestal en el expediente de contrataci√≥n antes de la fase de selecci√≥n, seg√∫n el Reglamento?`,
    options: [
      { text: "a) No, solo se incluye la cuant√≠a si es un procedimiento competitivo.", isCorrect: false },
      { text: "b) No, la certificaci√≥n presupuestal se incluye despu√©s de la buena pro.", isCorrect: false },
      { text: "c) S√≠, ambos son parte del contenido m√≠nimo requerido antes de la fase de selecci√≥n.", isCorrect: true },
      { text: "d) Solo se incluye la certificaci√≥n presupuestal, no la cuant√≠a.", isCorrect: false }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  },
  {
    id: 10,
    question: `¬øQu√© autoridad es la responsable de aprobar el expediente de contrataci√≥n antes de iniciar la fase de selecci√≥n?`,
    options: [
      { text: "a) El Titular de la Entidad.", isCorrect: false },
      { text: "b) El jefe de la Dependencia Encargada de las Contrataciones (DEC).", isCorrect: false },
      { text: "c) La autoridad de la gesti√≥n administrativa.", isCorrect: true },
      { text: "d) El √°rea usuaria.", isCorrect: false }
    ],
    block: "ACTUACIONES PREPARATORIAS"
  }
];

  // Elementos y estado
  const questionsArea = document.getElementById("questionsArea");
  const timerEl = document.getElementById("timer");
  const submitBtn = document.getElementById("submitBtn");
  const restartBtn = document.getElementById("restartBtn");
  const resultArea = document.getElementById("resultArea");

  let timeLeft = 60 * 60; // 60 minutos en segundos
  let timerInterval = null;
  let answered = {}; // {questionId: selectedOptionText}

  // util
  function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }

  // Construir interfaz con preguntas (y opciones mezcladas)
  function buildUI(){
    questionsArea.innerHTML = "";
    let currentBlock = "";
    questions.forEach((q) => {
      if(q.block && q.block !== currentBlock){
        currentBlock = q.block;
        const h = document.createElement("div");
        h.className = "section-title";
        h.textContent = currentBlock;
        questionsArea.appendChild(h);
      }
      const opts = q.options.map(o => ({...o}));
      shuffleArray(opts);
      const div = document.createElement("div");
      div.className = "question";
      const qtext = document.createElement("div");
      qtext.className = "qtext";
      qtext.innerHTML = `<strong>Pregunta ${q.id}.</strong> ${q.question}`;
      div.appendChild(qtext);
      const optsDiv = document.createElement("div");
      optsDiv.className = "options";
      opts.forEach(o => {
        const label = document.createElement("label");
        label.className = "option";
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = "q_" + q.id;
        radio.value = o.text;
        radio.addEventListener("change", () => {
          answered[q.id] = o.text;
        });
        label.appendChild(radio);
        const span = document.createElement("span");
        span.innerHTML = o.text;
        label.appendChild(span);
        optsDiv.appendChild(label);
      });
      div.appendChild(optsDiv);
      questionsArea.appendChild(div);
    });
  }

  function updateTimerDisplay(){
    const mm = String(Math.floor(timeLeft/60)).padStart(2,"0");
    const ss = String(timeLeft%60).padStart(2,"0");
    timerEl.textContent = `${mm}:${ss}`;
  }

  function startTimer(){
    clearInterval(timerInterval);
    updateTimerDisplay();
    timerInterval = setInterval(() => {
      timeLeft--;
      if(timeLeft <= 0){
        clearInterval(timerInterval);
        finishExam(true);
      } else updateTimerDisplay();
    }, 1000);
  }

  // Mostrar detalle de cada pregunta: seleccionada / correcta
  function buildDetail(correctCount, total){
    let html = `<div class="result"><h3>Resultado</h3>
      <p>Aciertos: <strong>${correctCount}</strong> de ${total}</p>`;

    // Nivel simple (solo si muchas preguntas, mantengo l√≥gica original)
    let levelText = "No aplicable (prueba corta)";
    if(total >= 58){
      if(correctCount >= 58) levelText = "Avanzado";
      else if(correctCount >= 43) levelText = "Intermedio";
      else if(correctCount >= 30) levelText = "B√°sico";
      else levelText = "Por debajo de B√°sico";
    }
    html += `<p>Nivel: <strong>${levelText}</strong></p>`;

    // Detalle por pregunta
    html += `<h4>Detalle por pregunta</h4>`;
    questions.forEach(q => {
      const sel = answered[q.id] || null;
      const correctOpt = q.options.find(o => o.isCorrect === true);
      const correctText = correctOpt ? correctOpt.text : "‚Äî";
      const wasCorrect = sel && sel.trim() === correctText.trim();
      const cls = wasCorrect ? "detail-item ok" : "detail-item bad";
      html += `<div class="${cls}">`;
      html += `<div style="font-weight:700">Pregunta ${q.id}.</div>`;
      html += `<div class="meta">${q.question}</div>`;
      html += `<div style="margin-top:8px"><strong>Tu respuesta:</strong> ${sel ? `<pre>${sel}</pre>` : '<em>No respondi√≥</em>'}</div>`;
      html += `<div><strong>Respuesta correcta:</strong> <pre>${correctText}</pre></div>`;
      html += `</div>`;
    });

    html += `</div>`;
    return html;
  }

  function finishExam(auto=false){
    clearInterval(timerInterval);
    // bloquear entradas
    document.querySelectorAll("input[type=radio]").forEach(r => r.disabled = true);
    submitBtn.disabled = true;

    // calcular aciertos
    let correctCount = 0;
    questions.forEach(q => {
      const sel = answered[q.id] || null;
      if(sel){
        const correctOpt = q.options.find(o => o.isCorrect === true);
        if(correctOpt && sel.trim() === correctOpt.text.trim()){
          correctCount++;
        }
      }
    });

    // mostrar resultado con detalle
    resultArea.innerHTML = buildDetail(correctCount, questions.length) + (auto ? '<p style="margin-top:10px"><em>Se termin√≥ el tiempo.</em></p>' : '');
    // scroll to results
    resultArea.scrollIntoView({behavior:"smooth"});
  }

  // eventos
  submitBtn.addEventListener("click", () => {
    if(!confirm("¬øDeseas entregar el simulacro ahora?")) return;
    finishExam(false);
  });
  restartBtn.addEventListener("click", () => {
    if(!confirm("Se recargar√° la p√°gina y se podr√° volver a intentar. ¬øContinuar?")) return;
    location.reload();
  });

  // iniciar
  buildUI();
  startTimer();
}
</script>
</body>
</html>
